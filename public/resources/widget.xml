<Module>
    <ModulePrefs 
        title="__MSG_title__" 
        title_url="__MSG_title_url__" 
        directory_title="__MSG_title__" 
        description="__MSG_description__" 
        screenshot="__MSG_screenshot__" 
        thumbnail="__MSG_thumbnail__" 
        category="tools" 
        category2="lifestyle" 
        author="__MSG_author__" 
        author_email="__MSG_author_email__">

        <Require feature="setprefs"/>
        <Require feature="dynamic-height"/>
        <Require feature="opensocial-2.5"/>
        <Require feature="osapi"/>
        
    </ModulePrefs>

    <!-- Default view -->
    <Content view="default" type="html">
    <![CDATA[
        
        <style>
            #epframeetherpad-container {
                height: 100%;
            }
        </style>
        <script type="text/javascript" src="http://blooming-stream-8059.herokuapp.com/js/jquery-1.9.1.min.js"></script>
        <script type="text/javascript">
            console.log("Loading...");
            gadgets.util.registerOnLoadHandler(function() {
                var personRequest = osapi.people.get();
                personRequest.execute(function(peopleResponse) {
                    var personDisplayName = peopleResponse.displayName;
                    console.log("Person display name: " + personDisplayName);
                    var groupRequest = osapi.groups.get();
                    groupRequest.execute(function(groupResponse) {
                    var firstGroupId = groupResponse.list[0].id;
                    console.log("Retrieved first group: " + firstGroupId);
                    var padId = firstGroupId.substr(firstGroupId.lastIndexOf(":")+1);
                    console.log("Pad ID: " + padId);
                    $('#etherpad_link').attr('href','http://beta.etherpad.org/p/' + padId);
                });

            });
        </script>

        <div id="infobar">
            Access your Group Etherpad in a separate window by clicking <a id="etherpad_link" href="" target="_blank">here</a>.<br/>
            You can also maximize this window to view your Group Etherpad.
        </div>

    ]]>
    </Content>

    <!-- View when maximized -->
    <Content view="canvas">
    <![CDATA[
        
        <style>
            #epframeetherpad-container {
                height: 100%;
            }
        </style>
        <script type="text/javascript" src="http://blooming-stream-8059.herokuapp.com/js/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="http://blooming-stream-8059.herokuapp.com/js/etherpad.js"></script>
        <script type="text/javascript">
            console.log("Loading...");
            gadgets.util.registerOnLoadHandler(function() {
                var personRequest = osapi.people.get();
                personRequest.execute(function(peopleResponse) {
                    var personDisplayName = peopleResponse.displayName;
                    console.log("Person display name: " + personDisplayName);
                    var groupRequest = osapi.groups.get();
                    groupRequest.execute(function(groupResponse) {
                    var firstGroupId = groupResponse.list[0].id;
                    console.log("Retrieved first group: " + firstGroupId);
                    var padId = firstGroupId.substr(firstGroupId.lastIndexOf(":")+1);
                    console.log("Pad ID: " + padId);
                    $('#etherpad_link').attr('href','http://beta.etherpad.org/p/' + padId);
                    $('#etherpad-container').pad({
                        'padId': padId,
                        'useMonospacedFont': true,
                        'showLineNumbers': true,
                        'showChat': false,
                        'showControls': false,
                        'userName': personDisplayName
                        });
                    });
                });

            });
        </script>

        <div id="infobar">
            <div id="etherpad-container"></div>
        </div>

    ]]>
    </Content>
</Module>
